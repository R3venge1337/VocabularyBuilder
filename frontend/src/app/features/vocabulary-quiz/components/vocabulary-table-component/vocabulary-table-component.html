<div class="table-container">
    <section class="filter-form-section">
        <h2 class="mat-h2">Filtrowanie Słówek</h2>
        
        <form [formGroup]="filterForm" (ngSubmit)="applyFilters()">
            <div class="filter-form-group">
                
                <mat-form-field appearance="outline">
                    <mat-label>Słowo/Fraza</mat-label>
                    <input matInput formControlName="word" (keyup.enter)="applyFilters()">
                </mat-form-field>

                <mat-form-field appearance="outline">
                    <mat-label>Status Opanowania</mat-label>
                    <mat-select formControlName="masteryStatus" (selectionChange)="handleSelectFilterChange()">
                        <mat-option [value]="null">-- Wszystkie --</mat-option>
                        @for (status of masteryStatusKeys; track status) {
                            <mat-option [value]="status">
                                {{ status | titlecase }} 
                            </mat-option>
                        }
                    </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline">
                    <mat-label>Część Mowy</mat-label>
                    <mat-select formControlName="partOfSpeech" (selectionChange)="handleSelectFilterChange()">
                        <mat-option [value]="null">-- Wszystkie --</mat-option>
                        @for (part of partOfSpeechKeys; track part) {
                            <mat-option [value]="part">{{ part | titlecase }}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline">
                    <mat-label>Źródło Kontekstu</mat-label>
                    <mat-select formControlName="contextSource" (selectionChange)="handleSelectFilterChange()">
                        <mat-option [value]="null">-- Wszystkie --</mat-option>
                        @for (source of contextSourceKeys; track source) {
                            <mat-option [value]="source">{{ source | titlecase }}</mat-option>
                        }
                    </mat-select>
                </mat-form-field>
            </div>
            <div class="filter-actions">
                    <button mat-raised-button color="primary" type="submit" [disabled]="isLoading()">
                        Filtruj
                    </button>
                    <button mat-button color="warn" type="button" (click)="clearFilters()" [disabled]="isLoading()">
                        Wyczyść Filtry
                    </button>
            </div>
        </form>
    </section>

       @if(isLoading()) {
        <div class="loading-indicator" >
        <mat-spinner diameter="40" color="primary"></mat-spinner>
        <span class="loading-text">Ładowanie danych...</span>
      </div>
       }
      

       @if(!isLoading()) {

        <div  class="table-card-wrapper">
        <table mat-table 
               [dataSource]="pageData().content" 
               class="words-table" 
               matSort 
               [matSortActive]="pagination().sortField"
               [matSortDirection]="matSortDirection()"
               (matSortChange)="handleSortChange($event)">
            
            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="id" class="header-cell"> ID </th>
                <td mat-cell *matCellDef="let element"> {{element.id}} </td>
            </ng-container>
            
            <ng-container matColumnDef="wordPhraseEn">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="wordPhraseEn" class="header-cell"> Angielski </th>
                <td mat-cell *matCellDef="let element" class="word-phrase-text"> {{element.wordPhraseEn}} </td>
            </ng-container>

            <ng-container matColumnDef="translationPl">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="translationPl" class="header-cell"> Polski </th>
                <td mat-cell *matCellDef="let element"> {{element.translationPl}} </td>
            </ng-container>
            
            <ng-container matColumnDef="partOfSpeech">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="partOfSpeech" class="header-cell"> Cz. Mowy </th>
                <td mat-cell *matCellDef="let element"> {{element.partOfSpeech}} </td>
            </ng-container>

            <ng-container matColumnDef="contextSource">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="contextSource" class="header-cell"> Wystąpienie </th>
                <td mat-cell *matCellDef="let element"> {{element.contextSource}} </td>
            </ng-container>

            <ng-container matColumnDef="masteryStatus">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="masteryStatus" class="header-cell"> Status </th>
                <td mat-cell *matCellDef="let element"> 
                  <span class="badge" [ngClass]="getBadgeClass(element.masteryStatus)">
                        {{element.masteryStatus}}
                    </span>
                </td>
            </ng-container>
            
            <ng-container matColumnDef="createdAt">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="createdAt" class="header-cell"> Data Dodania </th>
                <td mat-cell *matCellDef="let element"> {{element.createdAt | date:'y.MM.dd'}} </td>
            </ng-container>
            
            <tr mat-header-row *matHeaderRowDef="displayedColumns" class="table-header-row"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-data-row"></tr>

                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef> Akcje </th>
                  <td mat-cell *matCellDef="let element"> 
                    <button mat-icon-button color="warn" (click)="showEditDialog(element)">
                      <mat-icon>mode_edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="confirmAndDeleteWord(element)">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>
            
        </table>
        
        <mat-paginator [length]="pageData().totalElements"
                       [pageSize]="pageData().pageSize"
                       [pageIndex]="pageData().pageNumber - 1"
                       [pageSizeOptions]="[5, 10, 20, 50]"
                       (page)="handlePageEvent($event)"
                       aria-label="Wybierz stronę ze słówkami"
                       class="paginator-style">
        </mat-paginator>
      </div>
       }
      
       @if(!isLoading() && pageData().content.length === 0){
        <div  class="no-data-message">
        Brak słówek do wyświetlenia na tej stronie.
        </div>
       }
    </div>